<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="oISntcv5wYv-gFzCbOejeG4TxriAsyU0TghcNXvJUUw" />




















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="To use storage drivers effectively, you must understand how Docker builds and stores images. Then, you need an understanding of how these images are used by containers. Finally, you’ll need a short in">
<meta name="keywords" content="docker image,docker container,docker storage drive">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker Images, Containers, and Storage Drivers">
<meta property="og:url" content="https://bowenli86.github.io/2017/01/10/tools/docker/Docker-Images-Containers-and-Storage-Drivers/index.html">
<meta property="og:site_name" content="Bowen&#39;s blog">
<meta property="og:description" content="To use storage drivers effectively, you must understand how Docker builds and stores images. Then, you need an understanding of how these images are used by containers. Finally, you’ll need a short in">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/image-layers.jpg">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/container-layers.jpg">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/container-layers-cas.jpg">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/sharing-layers.jpg">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/saving-space.jpg">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/sharing-layers.jpg">
<meta property="og:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/shared-volume.jpg">
<meta property="og:updated_time" content="2018-04-10T04:29:25.552Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker Images, Containers, and Storage Drivers">
<meta name="twitter:description" content="To use storage drivers effectively, you must understand how Docker builds and stores images. Then, you need an understanding of how these images are used by containers. Finally, you’ll need a short in">
<meta name="twitter:image" content="https://docs.docker.com/engine/userguide/storagedriver/images/image-layers.jpg">



  <link rel="alternate" href="/atom.xml" title="Bowen's blog" type="application/atom+xml" />




  <link rel="canonical" href="https://bowenli86.github.io/2017/01/10/tools/docker/Docker-Images-Containers-and-Storage-Drivers/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Docker Images, Containers, and Storage Drivers | Bowen's blog</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-40978428-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-40978428-1');
</script>






  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bowen's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">keep learning - learning notes and blogs</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
          
  
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />About</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />Categories</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
</li>

      
        
        
          
  
  <li class="menu-item menu-item-sitemap">
    <a href="/sitemap.xml" rel="section">
      <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />Sitemap</a>
</li>

      

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://bowenli86.github.io/2017/01/10/tools/docker/Docker-Images-Containers-and-Storage-Drivers/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bowen Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bowen's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Docker Images, Containers, and Storage Drivers</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-10T14:07:53-08:00">2017-01-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/tools/" itemprop="url" rel="index"><span itemprop="name">tools</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/tools/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>To use storage drivers effectively, you must understand how Docker builds and stores images. Then, you need an understanding of how these images are used by containers. Finally, you’ll need a short introduction to the technologies that enable both images and container operations.</p>
<h2 id="Images-and-layers"><a href="#Images-and-layers" class="headerlink" title="Images and layers"></a>Images and layers</h2><p>Each Docker image references <strong>a list of read-only layers</strong> that represent filesystem differences. Layers are stacked on top of each other to form a base for a container’s root filesystem. The diagram below shows the Ubuntu 15.04 image comprising 4 stacked image layers.</p>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/image-layers.jpg" alt="image"></p>
<p>The Docker storage driver is responsible for stacking these layers and providing a single unified view.</p>
<blockquote>
<p>When you create a new container, you add <strong>a new, thin, writable layer</strong> on top of the underlying stack. This layer is often called the <strong>“container layer”</strong>. All changes made to the running container - such as writing new files, modifying existing files, and deleting files - are written to this thin writable container layer. The diagram below shows a container based on the Ubuntu 15.04 image.</p>
</blockquote>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/container-layers.jpg" alt="container"></p>
<h2 id="Content-Addressable-Storage"><a href="#Content-Addressable-Storage" class="headerlink" title="Content Addressable Storage"></a>Content Addressable Storage</h2><p>Docker 1.10 introduced <strong>a new content addressable storage model</strong>. This is a completely new way to address image and layer data on disk. Previously, image and layer data was referenced and stored using a randomly generated UUID. In the new model this is replaced by a secure content hash.</p>
<p>The new model improves security, provides a built-in way to avoid ID collisions, and guarantees data integrity after pull, push, load, and save operations. It also enables better sharing of layers by allowing many images to freely share their layers even if they didn’t come from the same build.</p>
<p>The diagram below shows an updated version of the previous diagram, highlighting the changes implemented by Docker 1.10.</p>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/container-layers-cas.jpg" alt="container"></p>
<p>As can be seen, all image layer IDs are cryptographic hashes, whereas the container ID is still a randomly generated UUID.</p>
<a id="more"></a>
<h2 id="Container-and-Layers"><a href="#Container-and-Layers" class="headerlink" title="Container and Layers"></a>Container and Layers</h2><p><strong>The major difference between a container and an image is the top writable layer.</strong> All writes to the container that add new or modify existing data are stored in this writable layer. When the container is deleted the writable layer is also deleted. The underlying image remains unchanged.</p>
<p><strong>Because each container has its own thin writable container layer, and all changes are stored in this container layer, this means that multiple containers can share access to the same underlying image and yet have their own data state.</strong></p>
<p>The diagram below shows multiple containers sharing the same Ubuntu 15.04 image.</p>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/sharing-layers.jpg" alt="shared image layer"></p>
<p>The Docker storage driver is responsible for enabling and managing both the image layers and the writable container layer. How a storage driver accomplishes these can vary between drivers. Two key technologies behind Docker image and container management are <strong>stackable image layers</strong> and <strong>copy-on-write (CoW)</strong>.</p>
<h2 id="The-copy-on-write-strategy"><a href="#The-copy-on-write-strategy" class="headerlink" title="The copy-on-write strategy"></a>The copy-on-write strategy</h2><p>Sharing is a good way to optimize resources.</p>
<p>People do this instinctively in daily life. For example, twins Jane and Joseph taking an Algebra class at different times from different teachers can share the same exercise book by passing it between each other. Now, suppose Jane gets an assignment to complete the homework on page 11 in the book. At that point, Jane copies page 11, completes the homework, and hands in her copy. The original exercise book is unchanged and only Jane has a copy of the changed page 11.</p>
<p><strong>Copy-on-write</strong> is a similar strategy of sharing and copying. In this strategy, system processes that need the same data share the same instance of that data rather than having their own copy. At some point, if one process needs to modify or write to the data, only then does the operating system make a copy of the data for that process to use. Only the process that needs to write has access to the data copy. All the other processes continue to use the original data.</p>
<p>Docker uses a <strong>copy-on-write</strong> technology with both images and containers. <strong>This CoW strategy optimizes both image disk space usage and the performance of container start times.</strong></p>
<p>The next sections look at how <strong>copy-on-write</strong> is leveraged with images and containers through sharing and copying.</p>
<h2 id="Sharing-promotes-smaller-images"><a href="#Sharing-promotes-smaller-images" class="headerlink" title="Sharing promotes smaller images"></a>Sharing promotes smaller images</h2><p>This section looks at <strong>image layers</strong> and <strong>copy-on-write technology</strong>. All image and container layers exist inside the Docker host’s local storage area and are managed by the storage driver. On Linux-based Docker hosts this is usually located under <code>/var/lib/docker/</code>.</p>
<p>The Docker client reports on image layers when instructed to pull and push images with docker pull and docker push.</p>
<p>The command below pulls the ubuntu:15.04 Docker image from Docker Hub.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull ubuntu:15.04</span><br><span class="line"></span><br><span class="line">15.04: Pulling from library/ubuntu</span><br><span class="line">1ba8ac955b97: Pull complete</span><br><span class="line">f157c4e5ede7: Pull complete</span><br><span class="line">0b7e98f84c4c: Pull complete</span><br><span class="line">a3ed95caeb02: Pull complete</span><br><span class="line">Digest: sha256:5e279a9df07990286cce22e1b0f5b0490629ca6d187698746ae5e28e604a640e</span><br><span class="line">Status: Downloaded newer image for ubuntu:15.04</span><br></pre></td></tr></table></figure>
<blockquote>
<p>From the output, you’ll see that the command actually pulls 4 image layers. Each of the above lines lists an image layer and its UUID or cryptographic hash. The combination of these four layers makes up the ubuntu:15.04 Docker image.</p>
</blockquote>
<p>Each of these layers is stored in its own directory inside the Docker host’s local storage are.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$  docker pull ubuntu:15.04</span><br><span class="line"></span><br><span class="line">15.04: Pulling from library/ubuntu</span><br><span class="line">47984b517ca9: Pull complete</span><br><span class="line">df6e891a3ea9: Pull complete</span><br><span class="line">e65155041eed: Pull complete</span><br><span class="line">c8be1ac8145a: Pull complete</span><br><span class="line">Digest: sha256:5e279a9df07990286cce22e1b0f5b0490629ca6d187698746ae5e28e604a640e</span><br><span class="line">Status: Downloaded newer image for ubuntu:15.04</span><br><span class="line"></span><br><span class="line">$ ls /var/lib/docker/aufs/layers</span><br><span class="line"></span><br><span class="line">47984b517ca9ca0312aced5c9698753ffa964c2015f2a5f18e5efa9848cf30e2</span><br><span class="line">c8be1ac8145a6e59a55667f573883749ad66eaeef92b4df17e5ea1260e2d7356</span><br><span class="line">df6e891a3ea9cdce2a388a2cf1b1711629557454fd120abd5be6d32329a0e0ac</span><br><span class="line">e65155041eed7ec58dea78d90286048055ca75d41ea893c7246e794389ecf203</span><br></pre></td></tr></table></figure>
<p>Notice how the four directories match up with the layer IDs of the downloaded image. </p>
<p>All versions of Docker still allow images to share layers. For example, If you pull an image that shares some of the same image layers as an image that has already been pulled, the Docker daemon recognizes this, and only pulls the layers it doesn’t already have stored locally. After the second pull, the two images will share any common image layers.</p>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/saving-space.jpg" alt="shared image layer"></p>
<h2 id="Copying-makes-containers-efficient"><a href="#Copying-makes-containers-efficient" class="headerlink" title="Copying makes containers efficient"></a>Copying makes containers efficient</h2><p>You learned earlier that a container is a Docker image with a thin writable, container layer added.</p>
<p>All writes made to a container are stored in the thin writable container layer. The other layers are read-only (RO) image layers and can’t be changed. This means that multiple containers can safely share a single underlying image. The diagram below shows multiple containers sharing a single copy of the ubuntu:15.04 image. Each container has its own thin RW layer, but they all share a single instance of the ubuntu:15.04 image:</p>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/sharing-layers.jpg" alt=""></p>
<p>When an existing file in a container is modified, Docker uses the storage driver to perform a copy-on-write operation. The specifics of operation depends on the storage driver. For the AUFS and OverlayFS storage drivers, the copy-on-write operation is pretty much as follows:</p>
<ul>
<li><p>Search through the image layers for the file to update. The process starts at the top, newest layer and works down to the base layer one layer at a time.</p>
</li>
<li><p>Perform a “copy-up” operation on the first copy of the file that is found. A “copy up” copies the file up to the container’s own thin writable layer.</p>
</li>
<li><p>Modify the copy of the file in container’s thin writable layer.</p>
</li>
</ul>
<p>Containers that write a lot of data will consume more space than containers that do not. This is because most write operations consume new space in the container’s thin writable top layer. If your container needs to write a lot of data, you should consider using a data volume.</p>
<p>A copy-up operation can incur a noticeable performance overhead. This overhead is different depending on which storage driver is in use. However, large files, lots of layers, and deep directory trees can make the impact more noticeable. Fortunately, the operation only occurs the first time any particular file is modified. Subsequent modifications to the same file do not cause a copy-up operation and can operate directly on the file’s existing copy already present in the container layer.</p>
<p>Let’s see what happens if we spin up 5 containers based on our changed-ubuntu image we built earlier:</p>
<ol>
<li><p>From a terminal on your Docker host, run the following docker run command 5 times.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -dit changed-ubuntu bash</span><br><span class="line"></span><br><span class="line">75bab0d54f3cf193cfdc3a86483466363f442fba30859f7dcd1b816b6ede82d4</span><br><span class="line"></span><br><span class="line">$ docker run -dit changed-ubuntu bash</span><br><span class="line"></span><br><span class="line">9280e777d109e2eb4b13ab211553516124a3d4d4280a0edfc7abf75c59024d47</span><br><span class="line"></span><br><span class="line">$ docker run -dit changed-ubuntu bash</span><br><span class="line"></span><br><span class="line">a651680bd6c2ef64902e154eeb8a064b85c9abf08ac46f922ad8dfc11bb5cd8a</span><br><span class="line"></span><br><span class="line">$ docker run -dit changed-ubuntu bash</span><br><span class="line"></span><br><span class="line">8eb24b3b2d246f225b24f2fca39625aaad71689c392a7b552b78baf264647373</span><br><span class="line"></span><br><span class="line">$ docker run -dit changed-ubuntu bash</span><br><span class="line"></span><br><span class="line">0ad25d06bdf6fca0dedc38301b2aff7478b3e1ce3d1acd676573bba57cb1cfef</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>This launches 5 containers based on the changed-ubuntu image. As each container is created, Docker adds a writable layer and assigns it a random UUID. This is the value returned from the docker run command.
</code></pre><ol start="2">
<li><p>Run the docker ps command to verify the 5 containers are running.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ docker ps</span><br><span class="line">CONTAINER ID    IMAGE             COMMAND    CREATED              STATUS              PORTS    NAMES</span><br><span class="line">0ad25d06bdf6    changed-ubuntu    &quot;bash&quot;     About a minute ago   Up About a minute            stoic_ptolemy</span><br><span class="line">8eb24b3b2d24    changed-ubuntu    &quot;bash&quot;     About a minute ago   Up About a minute            pensive_bartik</span><br><span class="line">a651680bd6c2    changed-ubuntu    &quot;bash&quot;     2 minutes ago        Up 2 minutes                 hopeful_turing</span><br><span class="line">9280e777d109    changed-ubuntu    &quot;bash&quot;     2 minutes ago        Up 2 minutes                 backstabbing_mahavira</span><br><span class="line">75bab0d54f3c    changed-ubuntu    &quot;bash&quot;     2 minutes ago        Up 2 minutes                 boring_pasteur</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>The output above shows 5 running containers, all sharing the changed-ubuntu image. Each CONTAINER ID is derived from the UUID when creating each container.
</code></pre><ol start="3">
<li><p>List the contents of the local storage area.</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo ls /var/lib/docker/containers</span><br><span class="line"></span><br><span class="line">0ad25d06bdf6fca0dedc38301b2aff7478b3e1ce3d1acd676573bba57cb1cfef</span><br><span class="line">9280e777d109e2eb4b13ab211553516124a3d4d4280a0edfc7abf75c59024d47</span><br><span class="line">75bab0d54f3cf193cfdc3a86483466363f442fba30859f7dcd1b816b6ede82d4</span><br><span class="line">a651680bd6c2ef64902e154eeb8a064b85c9abf08ac46f922ad8dfc11bb5cd8a</span><br><span class="line">8eb24b3b2d246f225b24f2fca39625aaad71689c392a7b552b78baf264647373</span><br></pre></td></tr></table></figure>
</li>
</ol>
<pre><code>![](https://docs.docker.com/engine/userguide/storagedriver/images/shared-uuid.jpg)
</code></pre><p>Docker’s copy-on-write strategy not only reduces the amount of space consumed by containers, it also reduces the time required to start a container. At start time, Docker only has to create the thin writable layer for each container. The diagram below shows these 5 containers sharing a single read-only (RO) copy of the changed-ubuntu image.</p>
<p>If Docker had to make an entire copy of the underlying image stack each time it started a new container, container start times and disk space used would be significantly increased.</p>
<h2 id="Data-volumes-and-the-storage-driver"><a href="#Data-volumes-and-the-storage-driver" class="headerlink" title="Data volumes and the storage driver"></a>Data volumes and the storage driver</h2><p><strong>When a container is deleted, any data written to the container that is not stored in a data volume is deleted along with the container.</strong></p>
<p>A <strong>data volume</strong> is a directory or file in the Docker host’s filesystem that is mounted directly into a container. Data volumes are not controlled by the storage driver. Reads and writes to data volumes bypass the storage driver and operate at native host speeds. You can mount any number of data volumes into a container. Multiple containers can also share one or more data volumes.</p>
<p>The diagram below shows a single Docker host running two containers. Each container exists inside of its own address space within the Docker host’s local storage area (<code>/var/lib/docker/...</code>). There is also a single shared data volume located at <code>/data</code> on the Docker host. This is mounted directly into both containers.</p>
<p><img src="https://docs.docker.com/engine/userguide/storagedriver/images/shared-volume.jpg" alt=""></p>
<p>Data volumes reside outside of the local storage area on the Docker host, further reinforcing their independence from the storage driver’s control. When a container is deleted, any data stored in data volumes persists on the Docker host.</p>
<hr>
<h2 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h2><ul>
<li><a href="https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/" target="_blank" rel="noopener">https://docs.docker.com/engine/userguide/storagedriver/imagesandcontainers/</a></li>
</ul>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docker-image/" rel="tag"># docker image</a>
          
            <a href="/tags/docker-container/" rel="tag"># docker container</a>
          
            <a href="/tags/docker-storage-drive/" rel="tag"># docker storage drive</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/29/tools/docker/Docker-Concept-Intro/" rel="next" title="Docker - Concept Intro">
                <i class="fa fa-chevron-left"></i> Docker - Concept Intro
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Bowen Li</p>
              <p class="site-description motion-element" itemprop="description">keep learning - learning notes and blogs</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">119</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">54</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">295</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/bowenli86" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/yourname" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/phoenixjiangnan" target="_blank" title="Weibo"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.linkedin.com/in/bowenli90" target="_blank" title="Linkedin"><i class="fa fa-fw fa-linkedin"></i>Linkedin</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Images-and-layers"><span class="nav-number">1.</span> <span class="nav-text">Images and layers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Content-Addressable-Storage"><span class="nav-number">2.</span> <span class="nav-text">Content Addressable Storage</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Container-and-Layers"><span class="nav-number">3.</span> <span class="nav-text">Container and Layers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-copy-on-write-strategy"><span class="nav-number">4.</span> <span class="nav-text">The copy-on-write strategy</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Sharing-promotes-smaller-images"><span class="nav-number">5.</span> <span class="nav-text">Sharing promotes smaller images</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Copying-makes-containers-efficient"><span class="nav-number">6.</span> <span class="nav-text">Copying makes containers efficient</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-volumes-and-the-storage-driver"><span class="nav-number">7.</span> <span class="nav-text">Data volumes and the storage driver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">8.</span> <span class="nav-text">References:</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bowen Li</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  







  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
